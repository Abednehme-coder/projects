INCLUDE "P16F877A.INC"


  CONFIG _CP_OFF C _WDT_OFF C _PWRTE_OFF C _BODEN_OFF C _LVP_OFF C _HS_OSC


REGB	EQU	0X20
REG1	EQU 0X21
REG2	EQU	0X22
REG3	EQU	0X23
ORG	0X00
 
CONFI	BSF	STATUS,RP0 MOVLW	H'EF'
MOVWF	TRISC
MOVLW	H'00'
MOVWF	TRISD
MOVLW H'02' ; PORTA ANALOG ; PORTE DIGITAL MOVWF ADCON1 ;
MOVLW H'00' ; PORTE OUTPUT MOVWF TRISE
MOVLW	B'00111111'
MOVWF	TRISB
BCF	STATUS,RP0


INIT	CLRF	PORTB
	CLRF	PORTC
	CLRF	PORTD
	CLRF	PORTE
	CALL	CONFILCD




CALL	DELAY2S
MAIN	MOVLW	H'01'
CALL	COMMAND BTFSS PORTB,5 GOTO CAREXIT BTFSC PORTB,4 GOTO MAIN
BSF	PORTC,RC4 CALL WAIT
 
BTFSC PORTC,3 GOTO CARENTER CALL	NOSPACE GOTO MAIN

CARENTER	CALL	HELLO
CALL	OPEN_BARRIER CALL	WAIT2
CALL	DELAY3S
CALL	CLOSE_BARRIER GOTO MAIN

CAREXIT	CALL	OPEN_BARRIERX CALL	WAIT3
CALL	CAROUT CALL	DELAY3S
CALL	CLOSE_BARRIERX GOTO MAIN

OPEN_BARRIER	MOVLW	D'40'
MOVWF	REGB
BSF		PORTB,6 CALL	DELAY1MS
BCF		PORTB,6 CALL	DELAY2MS DECFSZ	REGB GOTO $-5
RETURN
 
CLOSE_BARRIER MOVLW	D'40'
MOVWF	REGB
BSF		PORTB,6 CALL	DELAY2MS
BCF		PORTB,6 CALL	DELAY1MS DECFSZ	REGB GOTO $-5
RETURN


OPEN_BARRIERX MOVLW	D'40'
MOVWF	REGB
BSF		PORTB,7 CALL	DELAY1MS
BCF		PORTB,7 CALL	DELAY2MS DECFSZ	REGB GOTO $-5
RETURN


CLOSE_BARRIERX MOVLW	D'40'
MOVWF	REGB
BSF		PORTB,7 CALL	DELAY2MS
BCF		PORTB,7 CALL	DELAY1MS DECFSZ	REGB GOTO $-5
RETURN
 



HELLO	MOVLW	H'01'
CALL	COMMAND MOVLW	H'85' CALL	COMMAND MOVLW	A'H' CALL	CHAR
MOVLW	A'E' CALL	CHAR MOVLW	A'L' CALL	CHAR MOVLW	A'L' CALL	CHAR MOVLW	A'O' CALL	CHAR
MOVLW	H'C1' CALL	COMMAND MOVLW	A'P' CALL	CHAR
MOVLW	A'a' CALL	CHAR MOVLW	A'r' CALL	CHAR MOVLW	A'k' CALL	CHAR MOVLW	A' ' CALL	CHAR
 
MOVLW	A'S' CALL	CHAR MOVLW	A'l' CALL	CHAR MOVLW	A'o' CALL	CHAR MOVLW	A't' CALL	CHAR MOVF PORTC,W
ANDLW		H'07' CALL	TABLE
CALL	CHAR RETURN
NOSPACE MOVLW	H'01'
CALL	COMMAND MOVLW	H'87' CALL	COMMAND MOVLW	A'N' CALL	CHAR
MOVLW	A'O' CALL	CHAR
MOVLW	H'C5' CALL	COMMAND MOVLW	A'S' CALL	CHAR
MOVLW	A'P' CALL	CHAR MOVLW	A'A' CALL	CHAR
 
MOVLW	A'C' CALL	CHAR MOVLW	A'E' CALL	CHAR
RETURN


NOSPACE MOVLW	H'01'
CALL	COMMAND MOVLW	H'87' CALL	COMMAND MOVLW	A'N' CALL	CHAR
MOVLW	A'O' CALL	CHAR
MOVLW	H'C5' CALL	COMMAND MOVLW	A'S' CALL	CHAR
MOVLW	A'P' CALL	CHAR MOVLW	A'A' CALL	CHAR MOVLW	A'C' CALL	CHAR MOVLW	A'E' CALL	CHAR
RETURN


CAROUT	MOVLW	H'01'
 
CALL	COMMAND MOVLW	H'84' CALL	COMMAND MOVLW	A'C' CALL	CHAR
MOVLW	A'A' CALL	CHAR MOVLW	A'R' CALL	CHAR MOVLW	A' ' CALL	CHAR MOVLW	A'O' CALL	CHAR MOVLW	A'U' CALL	CHAR MOVLW	A'T' CALL	CHAR
RETURN


MOVE	MOVLW	H'01'
CALL	COMMAND MOVLW	H'86' CALL	COMMAND MOVLW	A'M' CALL	CHAR
MOVLW	A'O' CALL	CHAR MOVLW	A'V' CALL	CHAR
 
MOVLW	A'E' CALL	CHAR
RETURN


DELAY1MS MOVLW	D'05' MOVWF	REG1
MOVLW	D'66'
MOVWF	REG2
DECFSZ	REG2 GOTO $-1
DECFSZ	REG1 GOTO $-5
RETURN


DELAY2MS MOVLW	D'05' MOVWF	REG1
MOVLW	D'133'
MOVWF	REG2
DECFSZ	REG2 GOTO $-1
DECFSZ	REG1 GOTO $-5
RETURN


DELAY3MS MOVLW D'1'
MOVWF REG3 MOVLW D'6' MOVWF REG2 MOVLW D'166'
 
MOVWF REG1 DECFSZ REG1,F
GOTO $-1
DECFSZ REG2,F GOTO $-5 DECFSZ REG3,F GOTO $-9
RETURN


DELAY20MS	MOVLW D'1' MOVWF REG3
MOVLW D'25' MOVWF REG2 MOVLW D'255'
MOVWF REG1 DECFSZ REG1,F
GOTO $-1
DECFSZ REG2,F GOTO $-5 DECFSZ REG3,F GOTO $-9
RETURN


DELAY2S	MOVLW	D'10' MOVWF	REG3
MOVLW	D'255'
MOVWF	REG2
MOVLW	D'255'
MOVWF	REG1
 
DECFSZ	REG1 GOTO $-1
DECFSZ	REG2 GOTO $-5
DECFSZ	REG3 GOTO $-9
RETURN


DELAY3S  MOVLW    D'15'

MOVWF	REG3
MOVLW	D'255'
MOVWF	REG2
MOVLW	D'255'
MOVWF	REG1
DECFSZ	REG1
GOTO $-1	
DECFSZ	REG2
GOTO $-5	
DECFSZ	REG3
GOTO $-9	
RETURN	


TABLE   ADDWF    PCL,F
RETLW A'1' RETLW A'2' RETLW A'3' RETLW A'4' RETLW A'5' RETLW A'6'
 
RETLW A'7' RETLW A'8'

TABLE2   ADDWF    PCL,F
RETLW A'A' RETLW A'A' RETLW A'A' RETLW A'A' RETLW A'B' RETLW A'B' RETLW A'B' RETLW A'B'



WAIT	BTFSS PORTC,5 GOTO WAIT
BCF	PORTC,4 RETURN

COMMAND BCF PORTE,2 ; command mode BCF PORTE,0 ;E=0
MOVWF PORTD ;BYTE TO BE SENT NOP	; 1 MICROSECOND DELAY BSF PORTE,0 ; E = 1
NOP	; PULSE DELAY
BCF PORTE,0 ; FALLING WITH THE E CALL DELAY3MS ; TIME OF EXECUTION
RETURN
 
CHAR BSF PORTE,2 ; CHAR MODE BCF PORTE,0
MOVWF PORTD NOP
BSF PORTE,0 NOP
BCF PORTE,0 CALL DELAY3MS RETURN

CONFILCD CALL DELAY20MS; WARMING UP MOVLW H'3C'
CALL COMMAND MOVLW H'0C' CALL COMMAND MOVLW H'06'
CALL COMMAND
MOVLW H'01' ; CLEAR SCREEN CALL COMMAND
RETURN


WAIT2	BTFSS PORTB,4
GOTO WAIT2 RETURN

WAIT3	BTFSS PORTB,5
GOTO WAIT3 RETURN
 
END
