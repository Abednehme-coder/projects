INCLUDE "P16F877A.INC"


  CONFIG _CP_OFF C _WDT_OFF C _PWRTE_OFF C _BODEN_OFF C _LVP_OFF C _HS_OSC


TEMP	EQU	0X20
TEMPB	EQU	0X22
COUNTER EQU	0X21
REG1	EQU	0X23
REG2	EQU	0X24
REG3	EQU	0X25
SLOT	EQU	0X26 ORG 0X00

CONFI	BSF	STATUS,RP0 MOVLW	H'FF'
MOVWF	TRISB
MOVLW	H'00'
MOVWF	TRISD
MOVLW	H'02' ; PORTA ANALOG ; PORTE DIGITAL MOVWF	ADCON1 ;
MOVLW	H'00' ; PORTE OUTPUT MOVWF	TRISE
MOVLW	H'D0'
MOVWF	TRISC
BCF	STATUS,RP0
 

INIT	CLRF CLRF CLRF CLRF	PORTD PORTE PORTC COUNTER

MAIN	
BTFSC	
PORTC,4
	GOTO	CHECK
	GOTO	MAIN

CHECK	
BSF	
PORTE,0
	MOVF	PORTB,W
MOVWF	TEMP SUBLWH'00'
BTFSC STATUS,Z GOTO NOTFOUND
LOOP1 BTFSC TEMP,0
GOTO FOUND
RRF		TEMP,F INCF	COUNTER,F GOTO LOOP1

NOTFOUND	BCF	PORTC,3
BSF		PORTC,5 CLRF	PORTD
GOTO MAIN


FOUND
MOVF COUNTER,W
 
MOVWF	SLOT SUBLWH'00'
BTFSC STATUS,Z GOTO SLOT1 GOTO SLOTX

SLOT1 MOVLW	H'01'
MOVWF	PORTD
MOVWF	PORTC GOTO GUIDE

SLOTX MOVLW	H'01' MOVWF	TEMP DECF COUNTER,F MOVF COUNTER,W
LOOP2 BCF	STATUS,C
RLF	TEMP,F
MOVF COUNTER,W SUBLWH'00'
BTFSC STATUS,Z GOTO PUTIND DECF COUNTER,F GOTO LOOP2

PUTIND	MOVF TEMP,W MOVWF	PORTD
MOVLW	H'F8'
ANDWF	PORTC,W IORWF SLOT,W
 
MOVWF	PORTC GOTO GUIDE

GUIDE MOVF PORTD,W
ANDLW	B'11110000' SUBLWH'00'
BTFSC STATUS,Z
BSF	PORTE,2 BTFSS STATUS,Z
BSF	PORTE,1
BSF	PORTC,3
BSF	PORTC,5


WAIT	MOVF PORTB,W
MOVWF	TEMPB LOOPB MOVF TEMPB,W
SUBWFPORTB,W BTFSS STATUS,Z GOTO OFF GOTO LOOPB
CSIGNAL	BSF	PORTC,0




OFF	MOVF PORTB,W ADDWF	PORTD,W BTFSC STATUS,Z
GOTO OFF CLRF	PORTD CLRF	PORTE
 


GOTO MAIN
END
